<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Read how to implement the BFF Security Pattern with aspnetcore, Angular, and IdentityServer4">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Implementing the BFF Security Pattern with IdentityServer4" />
<meta property="og:description" content="Read how to implement the BFF Security Pattern with aspnetcore, Angular, and IdentityServer4" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gocloudnative.org/integration-manuals/integrating-with-identity-providers/identityserver4/quickstart/" /><meta property="article:section" content="integration-manuals" />


<title>Implementing the BFF Security Pattern with IdentityServer4 | GoCloudNative.Bff</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css" integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz&#43;OQteg=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.53aa967cb1e7c0538d88c00ea2c901c2f129fdf9339d64b904193b915287dd3b.js" integrity="sha256-U6qWfLHnwFONiMAOoskBwvEp/fkznWS5BBk7kVKH3Ts=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>GoCloudNative.Bff</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  
















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Implementing the BFF Security Pattern with IdentityServer4</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#step-1-configure-identityserver4">Step 1.) Configure IdentityServer4</a></li>
    <li><a href="#step-2-build-the-aspnetcore-api">Step 2.) Build the aspnetcore API</a></li>
    <li><a href="#step-3-build-the-bff">Step 3.) Build the BFF</a>
      <ul>
        <li><a href="#endpoints">Endpoints</a></li>
        <li><a href="#get-accountlogin">[GET] /account/login</a></li>
        <li><a href="#get-accountlogincallback">[GET] /account/login/callback</a></li>
        <li><a href="#get-accountme">[GET] /account/me</a></li>
        <li><a href="#get-accountend-session">[GET] /account/end-session</a></li>
      </ul>
    </li>
    <li><a href="#demo">Demo</a></li>
    <li><a href="#issues">Issues</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="implementing-the-bff-security-pattern-with-identityserver4">
  Implementing the BFF Security Pattern with IdentityServer4
  <a class="anchor" href="#implementing-the-bff-security-pattern-with-identityserver4">#</a>
</h1>
<p>Complete the following three steps to implement the BFF Security Pattern with IdentityServer4:</p>
<ol>
<li>Configure IdentityServer.</li>
<li>Create an aspnetcore API</li>
<li>Build a BFF</li>
</ol>
<h2 id="step-1-configure-identityserver4">
  Step 1.) Configure IdentityServer4
  <a class="anchor" href="#step-1-configure-identityserver4">#</a>
</h2>
<p>The GoCloudNatibe.Bff only supports the Authorization Code Flow with Proof Key for Client Exchange. That&rsquo;s why it is important to configure IdentityServer in a specific way. Configure the Client as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">readonly</span> Client Client = <span style="color:#66d9ef">new</span> Client
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set the ClientId and the ClientSecret</span>
</span></span><span style="display:flex;"><span>        ClientId = <span style="color:#e6db74">&#34;bff&#34;</span>,
</span></span><span style="display:flex;"><span>        ClientSecrets =
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">new</span> Secret(<span style="color:#e6db74">&#34;secret&#34;</span>.Sha256())
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Configure the Authorization Code flow with PKCE</span>
</span></span><span style="display:flex;"><span>        AllowedGrantTypes = GrantTypes.Code,
</span></span><span style="display:flex;"><span>        RequirePkce = <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Configure the access token lifetime (1h by default)</span>
</span></span><span style="display:flex;"><span>        AccessTokenLifetime = <span style="color:#ae81ff">3600</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Make sure IdentityServer may redirect to the bff</span>
</span></span><span style="display:flex;"><span>        RedirectUris = { <span style="color:#e6db74">&#34;https://localhost:8443/account/login/callback&#34;</span> }, 
</span></span><span style="display:flex;"><span>        FrontChannelLogoutUri = <span style="color:#e6db74">&#34;https://localhost:8443/&#34;</span>,
</span></span><span style="display:flex;"><span>        PostLogoutRedirectUris = { <span style="color:#e6db74">&#34;https://localhost:8443/&#34;</span> },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Enable offline access, the BFF needs it to refresh the tokens</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// after they expire. Otherwise the session would end after 1h.</span>
</span></span><span style="display:flex;"><span>        AllowOfflineAccess = <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Add the profile claims to the id token so they are available</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// in the /account/me endpoint of the BFF.</span>
</span></span><span style="display:flex;"><span>        AlwaysIncludeUserClaimsInIdToken = <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        AllowedScopes = 
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            IdentityServerConstants.StandardScopes.OpenId,
</span></span><span style="display:flex;"><span>            IdentityServerConstants.StandardScopes.Profile,
</span></span><span style="display:flex;"><span>            IdentityServerConstants.StandardScopes.Email,
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// .. other scopes</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    };
</span></span></code></pre></div><p>Find a sample identity-server implementation here: <a href="https://github.com/thecloudnativewebapp/GoCloudNative.Bff/tree/main/docs/Integration-Manuals/Integrating-With-Identity-Providers/IdentityServer4/src/IdentityServer4">https://github.com/thecloudnativewebapp/GoCloudNative.Bff/tree/main/docs/Integration-Manuals/Integrating-With-Identity-Providers/IdentityServer4/src/IdentityServer4</a></p>
<h2 id="step-2-build-the-aspnetcore-api">
  Step 2.) Build the aspnetcore API
  <a class="anchor" href="#step-2-build-the-aspnetcore-api">#</a>
</h2>
<p>Create a new project:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dotnet new webapi
</span></span><span style="display:flex;"><span>dotnet add package Microsoft.AspNetCore.Authentication.JwtBearer
</span></span></code></pre></div><p>Create the following <code>Program.cs</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Security.Claims;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.AspNetCore.Authentication.JwtBearer;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.IdentityModel.Tokens;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
</span></span><span style="display:flex;"><span>    .AddJwtBearer(<span style="color:#e6db74">&#34;Bearer&#34;</span>, options =&gt;
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        options.Authority = builder.Configuration[<span style="color:#e6db74">&#34;Oidc:Authority&#34;</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        options.TokenValidationParameters = <span style="color:#66d9ef">new</span> TokenValidationParameters
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            ValidateAudience = <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>builder.Services.AddControllers();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> app = builder.Build();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app.UseHttpsRedirection();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app.UseAuthorization();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app.MapControllers();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app.Run();
</span></span></code></pre></div><p>Make sure you have configured IdentityServer in your <code>appsettings.json</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Logging&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;LogLevel&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Default&#34;</span>: <span style="color:#e6db74">&#34;Information&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Microsoft.AspNetCore&#34;</span>: <span style="color:#e6db74">&#34;Warning&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Oidc&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Authority&#34;</span>: <span style="color:#e6db74">&#34;https://{yourAuthority}&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;AllowedHosts&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In this example, we assume you&rsquo;re running this API on port 8080. To get this API to run on that port, modify your <code>LaunchSettings.json</code> file to like like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;profiles&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;http&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;commandName&#34;</span>: <span style="color:#e6db74">&#34;Project&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;dotnetRunMessages&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;launchBrowser&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;launchUrl&#34;</span>: <span style="color:#e6db74">&#34;/&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;applicationUrl&#34;</span>: <span style="color:#e6db74">&#34;http://localhost:8080&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;environmentVariables&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;ASPNETCORE_ENVIRONMENT&#34;</span>: <span style="color:#e6db74">&#34;Development&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="step-3-build-the-bff">
  Step 3.) Build the BFF
  <a class="anchor" href="#step-3-build-the-bff">#</a>
</h2>
<p>To build a BFF with aspnet core, execute the following commands on the command line:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dotnet new web
</span></span><span style="display:flex;"><span>dotnet add package GoCloudNative.Bff.Authentication.OpenIdConnect
</span></span></code></pre></div><p>Create the following <code>Program.cs</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> GoCloudNative.Bff.Authentication.OpenIdConnect;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> GoCloudNative.Bff.Authentication.ModuleInitializers;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>builder.Services.AddSecurityBff(o =&gt;
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    o.ConfigureOpenIdConnect(builder.Configuration.GetSection(<span style="color:#e6db74">&#34;Oidc&#34;</span>));
</span></span><span style="display:flex;"><span>    o.LoadYarpFromConfig(builder.Configuration.GetSection(<span style="color:#e6db74">&#34;ReverseProxy&#34;</span>));
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> app = builder.Build();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app.UseRouting();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app.UseSecurityBff();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app.Run();
</span></span></code></pre></div><p>Create the following <code>appsettings.json</code> file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Logging&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;LogLevel&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Default&#34;</span>: <span style="color:#e6db74">&#34;Information&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Microsoft.AspNetCore&#34;</span>: <span style="color:#e6db74">&#34;Warning&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Oidc&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ClientId&#34;</span>: <span style="color:#e6db74">&#34;{yourClientId}&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ClientSecret&#34;</span>: <span style="color:#e6db74">&#34;{yourClientSecret}&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Authority&#34;</span>: <span style="color:#e6db74">&#34;https://{yourAuthority}&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Scopes&#34;</span>: [
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;openid&#34;</span>, <span style="color:#e6db74">&#34;profile&#34;</span>, <span style="color:#e6db74">&#34;offline_access&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;AllowedHosts&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;ReverseProxy&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Routes&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;spa&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;ClusterId&#34;</span>: <span style="color:#e6db74">&#34;spa&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Match&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;Path&#34;</span>: <span style="color:#e6db74">&#34;/{*any}&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;api&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;ClusterId&#34;</span>: <span style="color:#e6db74">&#34;api&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Match&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;Path&#34;</span>: <span style="color:#e6db74">&#34;/api/{*any}&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Clusters&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;spa&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Destinations&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;spa&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;Address&#34;</span>: <span style="color:#e6db74">&#34;http://localhost:4200/&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;api&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Destinations&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;api&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;Address&#34;</span>: <span style="color:#e6db74">&#34;http://localhost:8080/&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Use the following <code>Properties/launchSettings.json</code>, this launchSettings file ensures the application url matches the callback url that has been configured in IdentityServer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;profiles&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;https&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;commandName&#34;</span>: <span style="color:#e6db74">&#34;Project&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;dotnetRunMessages&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;launchBrowser&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;applicationUrl&#34;</span>: <span style="color:#e6db74">&#34;https://localhost:8443&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;environmentVariables&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;ASPNETCORE_ENVIRONMENT&#34;</span>: <span style="color:#e6db74">&#34;Development&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In this example we assume you are running a Single Page Application on localhost on port <code>4200</code> and you have an API running at localhost on port <code>8080</code>. If that is not the case, then update the <code>appsettings.json</code> accordingly.</p>
<p>To run the BFF, type <code>dotnet run</code> or just hit the &lsquo;play&rsquo;-button in Visual Studio. When you run the BFF, make sure to have your API and your SPA running too.</p>
<h3 id="endpoints">
  Endpoints
  <a class="anchor" href="#endpoints">#</a>
</h3>
<p>The BFF relays all requests as configured in the <code>ReverseProxy</code> section in the <code>appsettings.json</code> file, except for four endpoints:</p>
<h3 id="get-accountlogin">
  [GET] /account/login
  <a class="anchor" href="#get-accountlogin">#</a>
</h3>
<p>To log a user in and to start a http session, navigate to <code>/account/login</code>. The software will redirect to the login page of the Identity Provider to log the user in. The resulting tokens will be stored in the user session and are not available in the browser.</p>
<h3 id="get-accountlogincallback">
  [GET] /account/login/callback
  <a class="anchor" href="#get-accountlogincallback">#</a>
</h3>
<p>This endpoint is used by the IdentityProvider.</p>
<h3 id="get-accountme">
  [GET] /account/me
  <a class="anchor" href="#get-accountme">#</a>
</h3>
<p>To see the logged in user, navigate to the <code>/account/me</code> endpoint. This endpoint shows the claims that are in the <code>id_token</code>.</p>
<h3 id="get-accountend-session">
  [GET] /account/end-session
  <a class="anchor" href="#get-accountend-session">#</a>
</h3>
<p>To revoke the tokens that have been obtained when the user logged in, navigate to <code>/account/end-session</code> endpoint. This will revoke the tokens that have been stored in the user session. This will also end the user-session on at the Identity Provider</p>
<h2 id="demo">
  Demo
  <a class="anchor" href="#demo">#</a>
</h2>
<p>Check out a fully working demo <a href="https://github.com/thecloudnativewebapp/GoCloudNative.Bff/tree/main/docs/demos/IdentityServer4/src">here</a>.</p>
<h2 id="issues">
  Issues
  <a class="anchor" href="#issues">#</a>
</h2>
<p>Are you encountering issues? Please let us know at: <a href="https://github.com/thecloudnativewebapp/GoCloudNative.Bff/issues">https://github.com/thecloudnativewebapp/GoCloudNative.Bff/issues</a></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





  <div style="width:100%;">
    <a style="float:right;" href="https://www.linkedin.com/in/albert-starreveld/" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="Edit" />
      <span><i>by Albert Starreveld</i></span>
    </a>
  </div>
</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
    </aside>
    
  </main>

  
</body>
</html>












