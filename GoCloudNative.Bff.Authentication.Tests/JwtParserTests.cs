using FluentAssertions;

namespace GoCloudNative.Bff.Authentication.Tests;

public class JwtParserTests
{
    [Fact]
    public void ShouldConvertPayload()
    {
        const string jwt = "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InYtMUZ3RS1tSlhqVW50WTlEN0ZJVyJ9.eyJnaXZlbl9uYW1lIjoiQWxiZXJ0IiwiZmFtaWx5X25hbWUiOiJTdGFycmV2ZWxkIiwibmlja25hbWUiOiJhYnN0YXJyZXZlbGQiLCJuYW1lIjoiQWxiZXJ0IFN0YXJyZXZlbGQiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUdObXl4YVR2NTVsUVJQNkFualR2UHAzVE9KeVRsdjhYSVc1Rk05RW1FUFZPdz1zOTYtYyIsImxvY2FsZSI6ImVuIiwidXBkYXRlZF9hdCI6IjIwMjMtMDUtMTdUMDk6MTU6NDIuNTg2WiIsImlzcyI6Imh0dHBzOi8vaWRlbnRpZmljZXJlbi5ldS5hdXRoMC5jb20vIiwiYXVkIjoid1hhanBQNWRWdzlIYmlwcURSWHBsVUU1WVk4aTNBY3ciLCJpYXQiOjE2ODQ0MTY1NTMsImV4cCI6MTY4NDQxNzMwMywic3ViIjoiZ29vZ2xlLW9hdXRoMnwxMDE4ODc3NzE4MzIwMDMzNjUwMDEiLCJzaWQiOiJTMkF6Wm0tMnRwbWV0NnU3bVJISmtKbWtWY3dYXzhtYyJ9.THMYl8SsnAKeXlU8WwRPnWaMqDc3OBXbNH7MMj3L2zSkJo1VV5FXfSMhKoBWY0bxB2YnccRRX9ktNhWdv8PvoWq-ZV3NcHl77FtKUMpievXI88O4NKtrB3RLJEE8ZyHOt2nnaXEC36V9B-OSKzAddssoI5LH2zLwbJlt24qUfHVfpyRnLUT66HA40I7aob9s6zg-OM3Mwjw_DY7IMUE_TrETQ6ZztGA6d4T13UIccG5_KyMMtKGxIW9q_UVEAUasFhdpptSEZU72IVBW7dKyQ8sOrSalxZkyh106lmqIZ5m9_5eEKSMheZzPGXs5weJbIbjjl-0upGq-RdF191cWBA";

        var actual = jwt.ParseJwtPayload();

        actual.Should().NotBeNull();
    }
    
    [Fact]
    public void ShouldConvertAnnoyingJwt()
    {
        // According to the base64 spec the payload of this token should end with two = characters, otherwise it cannot be parsed
        const string annoyingJwt = "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IndZbEhzSFFtaHpyOFBpSXZiVExneCJ9.eyJnaXZlbl9uYW1lIjoiQWxiZXJ0IiwiZmFtaWx5X25hbWUiOiJTdGFycmV2ZWxkIiwibmlja25hbWUiOiJhYnN0YXJyZXZlbGQiLCJuYW1lIjoiQWxiZXJ0IFN0YXJyZXZlbGQiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUdObXl4YVR2NTVsUVJQNkFualR2UHAzVE9KeVRsdjhYSVc1Rk05RW1FUFZPdz1zOTYtYyIsImxvY2FsZSI6ImVuIiwidXBkYXRlZF9hdCI6IjIwMjMtMDUtMThUMDc6NDE6MjYuNzU2WiIsImlzcyI6Imh0dHBzOi8vZGV2LXBnaHljZXJlcTRrNHQzcGIudXMuYXV0aDAuY29tLyIsImF1ZCI6ImFKMmNiOGRoNU5qcGM1cGNvbGhsYUVpangzc0owaHd4IiwiaWF0IjoxNjg0NDE1NzY4LCJleHAiOjE2ODQ0NTE3NjgsInN1YiI6Imdvb2dsZS1vYXV0aDJ8MTAxODg3NzcxODMyMDAzMzY1MDAxIiwic2lkIjoiMHlDNU91enA4dVN0dWVkdDQxbDF3VzFCM3p6RTk4cFkifQ.GR_w8QcsDj8x1mSK7GnihYup-Cym27WgVI2I3aLEAMCYjaKJcdK7213Pv1vYvSMgPsn2AQwx7y8X-yY3xt26Vn4bpeAUgkMGVw0Rj4GBd1QmBJODnEqzwBHCJ1m9QtjmkvgJd9gVLP1IFANKFZSYBT5EkhotIkiDX0Z1kOKFdfI9gXn-GM29F58_ifPZ3XFpnQegslpVSExHBrq_gWxQ9mOdalNaqDerG2RrpGzMa7YTX-LuBiLKHmpYQxgycsHftbrQx2p2TwI7tBvQ-ndBNEgeK9aaP0fHy2Y6oEb4e9kLCRbkoZdR69tTtaPiCnpwACQqJOy3ZKnRkvD53EGJiQ";

        var actual = annoyingJwt.ParseJwtPayload();

        actual.Should().NotBeNull();
    }
}